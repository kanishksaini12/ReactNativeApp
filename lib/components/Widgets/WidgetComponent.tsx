import SvgChart, {SVGRenderer} from '@wuba/react-native-echarts/svgChart';
import * as echarts from 'echarts/core';
import {useRef, useEffect} from 'react';
import {
  BarChart,
  LineChart,
  ParallelChart,
  PieChart,
  SunburstChart,
} from 'echarts/charts';
import {
  TitleComponent,
  TooltipComponent,
  GridComponent,
  LegendComponent,
  LegendScrollComponent,
  VisualMapComponent,
  DataZoomComponent,
} from 'echarts/components';

import {Card} from 'react-native-paper';
import {Dimensions, StyleSheet} from 'react-native';

// Register extensions
echarts.use([
  TitleComponent,
  TooltipComponent,
  GridComponent,
  SVGRenderer,
  PieChart,
  LegendComponent,
  LegendScrollComponent,
  ParallelChart,
  VisualMapComponent,
  LineChart,
  DataZoomComponent,
]);

const E_HEIGHT = 250;
const E_WIDTH = Dimensions.get('window').width - 32;

function ChartComponent({option}: any) {
  const chartRef = useRef<any>(null);

  useEffect(() => {
    let chart: any;
    if (chartRef.current) {
      // @ts-ignore
      chart = echarts.init(chartRef.current, 'light', {
        renderer: 'svg',
        width: E_WIDTH,
        height: E_HEIGHT,
      });
      chart.setOption(option);
    }
    return () => chart?.dispose();
  }, [option]);

  return <SvgChart style={styles.chart} ref={chartRef} />;
}

function WidgetComponent() {
  // const option = {
  //   xAxis: {
  //     type: 'category',
  //     data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
  //   },
  //   yAxis: {
  //     type: 'value',
  //   },
  //   series: [
  //     {
  //       data: [120, 200, 150, 80, 70, 110, 130],
  //       type: 'bar',
  //     },
  //   ],
  // };

  const option = {
    grid: {
      right: 25,
      left: 60,
      top: 25,
      bottom: 100,
      show: false,
      borderWidth: 1,
    },
    tooltip: {
      show: true,
      trigger: 'axis',
    },
    legend: {
      show: true,
      type: 'scroll',
      width: '70%',
    },
    xAxis: {
      show: true,
      name: '',
      nameLocation: null,
      nameGap: null,
      type: 'category',
      axisLabel: {
        show: true,
        color: '#ffffff',
        rotate: '0',
        hideOverlap: true,
      },
      data: [
        949.3846153846154, 1097.9839464882944, 767.7632107023411,
        990.6622073578595, 1849.2361204013378, 1733.6588628762543,
        610.9083612040134, 998.9177257525083, 16.51103678929766,
        1560.2929765886288, 1122.7505016722407, 734.7411371237458,
        709.9745819397994, 1370.4160535117057, 90.81070234113713,
        198.1324414715719, 544.8642140468228, 1857.4916387959865,
        181.62140468227426, 2162.9458193979935, 2195.9678929765887,
        1155.772575250836, 2072.1351170568564, 1981.324414715719,
        2055.6240802675584, 1197.0501672240803, 231.15451505016722,
        1634.5926421404683, 305.4541806020067, 2377.589297658863,
        1651.103678929766, 2113.4127090301004, 627.419397993311,
        404.52040133779263, 247.66555183946488, 1940.046822742475,
        1799.7030100334448, 49.533110367892974, 2121.668227424749,
        883.3404682274247, 1898.7692307692307, 107.32173913043478,
        619.1638795986622, 478.82006688963213, 1642.8481605351171,
        1378.6715719063545, 1807.9585284280936, 1238.3277591973244,
        2402.3558528428093, 1023.6842809364549, 676.952508361204,
        1081.4729096989968, 2022.6020066889632, 1774.9364548494984,
        668.6969899665552, 2410.611371237458, 1172.283612040134,
        2303.2896321070234, 1708.8923076923077, 685.2080267558529,
        1271.3498327759198, 1840.980602006689, 454.05351170568565,
        1601.570568561873, 255.92107023411373, 272.4321070234114,
        1874.0026755852844, 1502.504347826087, 1783.1919732441472,
        1824.4695652173914, 908.1070234113713, 487.0755852842809,
        2262.0120401337795, 866.8294314381271, 41.27759197324415,
        1865.7471571906356, 1741.914381270903, 1089.7284280936456,
        412.7759197324415, 1882.2581939799331, 173.36588628762541,
        2237.2454849498326, 2319.800668896321, 1353.905016722408,
        1494.2488294314383, 1684.1257525083613, 850.3183946488294,
        1535.5264214046822, 1750.1698996655518, 1164.028093645485,
        594.3973244147157, 346.73177257525083, 577.886287625418,
        495.33110367892976, 1205.305685618729, 1667.6147157190635,
        2129.923745819398, 1419.9491638795987, 875.0849498327759,
        74.29966555183947, 132.08829431438127, 2270.2675585284283,
        660.4414715719064, 833.8073578595317, 726.485618729097,
        1659.3591973244147, 1915.2802675585285, 239.41003344481607,
        379.75384615384615, 2286.778595317726, 776.01872909699,
        1056.7063545150502, 2468.4, 1403.4381270903011, 1758.4254180602006,
        701.7190635451506, 1040.1953177257526, 1469.4822742474917,
        1675.8702341137123, 330.2207357859532, 2369.333779264214,
        388.009364548495, 693.4635451505017, 1015.428762541806,
        809.0408026755853, 2418.866889632107, 445.7979933110368,
        1576.8040133779264, 561.3752508361204, 1923.5357859531773,
        1717.1478260869565, 2385.8448160535117, 1948.3023411371237,
        371.4983277591973, 2352.8227424749166, 396.2648829431438,
        1890.513712374582, 602.6528428093645, 1766.6809364548494,
        643.9304347826087, 82.5551839464883, 916.3625418060201,
        2451.8889632107025, 1700.6367892976589, 1618.0816053511705,
        553.1197324414716, 264.17658862876254, 1832.7250836120402,
        2146.4347826086955, 2154.6903010033443, 1254.838795986622,
        2212.4789297658863, 528.3531772575251, 2336.3117056856186,
        2435.377926421405, 1411.69364548495, 718.2301003344481,
        57.788628762541805, 536.6086956521739, 2394.1003344481605,
        1213.5612040133778, 1725.4033444816055, 2088.646153846154,
        1436.4602006688963, 1007.1732441471572, 817.2963210702342,
        1263.0943143812708, 1461.2267558528429, 2096.901672240803,
        437.54247491638796, 511.84214046822746, 140.3438127090301,
        2328.05618729097, 1552.03745819398, 784.2742474916388,
        2014.3464882943144, 2344.567224080268, 1510.7598662207358,
        2443.6334448160537, 2030.857525083612, 1139.2615384615385,
        1568.5484949832776, 2295.0341137123746, 1147.5170568561873,
        2187.71237458194, 2063.879598662207, 8.25551839464883,
        891.5959866220736, 965.895652173913, 148.59933110367894,
        189.87692307692308, 313.7096989966555, 759.5076923076923,
        1106.2394648829431, 1337.3939799331104, 1609.8260869565217,
        24.766555183946487, 1585.0595317725752, 1279.6053511705686,
        2080.390635451505, 1428.2046822742475, 2460.1444816053513,
        899.8515050167224, 2138.1792642140467, 66.04414715719064,
        1444.715719063545, 742.9966555183946, 1329.1384615384616,
        338.476254180602, 2179.456856187291, 974.1511705685618,
        1296.1163879598662, 1527.2709030100334, 1964.8133779264215,
        1312.627424749164, 1973.0688963210703, 2047.3685618729098,
        99.06622073578595, 1073.2173913043478, 321.96521739130435,
        2039.1130434782608, 1221.8167224080269, 2311.545150501672,
        941.1290969899666, 165.1103678929766, 115.57725752508361,
        2253.7565217391307, 297.19866220735787, 1519.0153846153846,
        2171.2013377926423, 924.6180602006689, 2228.989966555184,
        354.9872909698997, 1395.182608695652, 1816.2140468227426,
        421.0314381270903, 751.2521739130435, 1320.8829431438128,
        2105.1571906354516, 1485.9933110367892, 1997.8354515050166,
        222.8989966555184, 932.8735785953178, 569.6307692307693,
        1230.0722408026757, 1304.371906354515, 2278.523076923077,
        2204.2234113712375, 982.4066889632107, 2006.0909698996657,
        1593.3150501672242, 1114.494983277592, 2361.0782608695654,
        520.0976588628763, 586.141806020067, 1048.4508361204014,
        1989.5799331103678, 280.6876254180602, 206.38795986622074,
        1345.6494983277591, 156.85484949832775, 842.0628762541807,
        2427.1224080267557, 363.2428093645485, 1543.7819397993312,
        288.943143812709, 800.7852842809365, 1791.447491638796,
        957.6401337792643, 1180.5391304347827, 1246.5832775919732,
        652.1859531772575, 0, 1477.7377926421404, 2245.5010033444814,
        1626.3371237458193, 470.5645484949833, 1956.5578595317727,
        1907.0247491638797, 825.551839464883, 1188.7946488294315,
        1692.38127090301, 1287.8608695652174, 214.64347826086956,
        1452.971237458194, 1064.961872909699, 1931.791304347826,
        429.2869565217391, 635.6749163879599, 858.5739130434782,
        1031.9397993311036, 123.83277591973244, 1362.160535117057,
        2220.734448160535, 792.5297658862876, 1386.9270903010033,
        503.5866220735786, 33.02207357859532, 462.30903010033444,
        1131.0060200668897,
      ],
    },
    yAxis: [
      {
        show: true,
        name: null,
        nameLocation: null,
        nameGap: null,
        type: 'value',
        axisLabel: {
          show: true,
          color: '#ffffff',
          rotate: '0',
          hideOverlap: true,
        },
        axisPointer: {},
        min: 'dataMin',
        max: 'dataMax',
        offset: 0,
        data: [
          0.20495012, 0.13541521, 0.31491888, 0.1837843, 0.0046944944,
          0.009405254, 0.4306811, 0.17972293, 0.9834896, 0.023193464,
          0.12559737, 0.3377702, 0.35545743, 0.052894924, 0.9093128, 0.8032042,
          0.48452348, 0.00445315, 0.81940347, 0.00044928942, 0.00033530974,
          0.113270976, 0.00095740467, 0.0019103561, 0.0010906686, 0.09906384,
          0.77098596, 0.016056756, 0.6995635, 0.00005574342, 0.014740944,
          0.0006846094, 0.4176658, 0.60732496, 0.7549773, 0.002562876,
          0.0063857147, 0.95048624, 0.0006391207, 0.24179025, 0.0033976268,
          0.892884, 0.42415038, 0.5410046, 0.015387503, 0.05119416,
          0.0060729114, 0.0861502, 0.000042513493, 0.16788144, 0.3797523,
          0.14223698, 0.0014064283, 0.0074058706, 0.38595054, 0.000038784023,
          0.107429974, 0.00012083279, 0.010804862, 0.37360358, 0.07671707,
          0.004946765, 0.56280464, 0.01897175, 0.74700034, 0.7311045,
          0.004001774, 0.030312747, 0.0070517617, 0.005485636, 0.22754742,
          0.53381026, 0.00018127044, 0.25156888, 0.95873344, 0.0042223623,
          0.00897332, 0.13879828, 0.59982395, 0.0037910189, 0.8275233,
          0.00022938804, 0.00010225023, 0.056422327, 0.03145515, 0.012370658,
          0.26157296, 0.026062487, 0.008557883, 0.11032392, 0.4438788,
          0.66066176, 0.45725456, 0.526653, 0.096379176, 0.01351368,
          0.00059631455, 0.043297987, 0.2466513, 0.92576724, 0.8682995,
          0.00016737026, 0.3921976, 0.27180114, 0.34361437, 0.014116502,
          0.003039505, 0.7629727, 0.630011, 0.00014240216, 0.30933884,
          0.15288894, 0.000019957717, 0.046337232, 0.008158478, 0.36145565,
          0.16027185, 0.035083394, 0.012931906, 0.67614794, 0.000060921757,
          0.6224191, 0.36750445, 0.17177157, 0.2875598, 0.000035354704,
          0.5701416, 0.021423692, 0.47080424, 0.0028728633, 0.010320533,
          0.000050967705, 0.002418941, 0.63763183, 0.000072606956, 0.6148569,
          0.0035897489, 0.43725744, 0.007774628, 0.40483662, 0.91753715,
          0.22291367, 0.000024224842, 0.011307648, 0.017465534, 0.4776429,
          0.73904246, 0.0052103526, 0.0005182143, 0.00048266485, 0.08133593,
          0.0002886102, 0.49840772, 0.00008628491, 0.000029311084, 0.04479813,
          0.34951022, 0.9422423, 0.4914452, 0.00004656649, 0.093745865,
          0.009854155, 0.00083860103, 0.040412378, 0.17571868, 0.28225172,
          0.07900226, 0.03636184, 0.0007842011, 0.5775126, 0.5124525,
          0.86012274, 0.00009396208, 0.024120629, 0.30381265, 0.0014967811,
          0.000079179335, 0.029202892, 0.000026657342, 0.001320848, 0.11932598,
          0.022294665, 0.00013121904, 0.11627158, 0.0003610858, 0.0010221397,
          0.9917445, 0.23698576, 0.19631195, 0.8519561, 0.8112968, 0.69173443,
          0.32055223, 0.13208748, 0.060121343, 0.018206168, 0.9752357,
          0.020579914, 0.07447983, 0.0008962813, 0.041836258, 0.000021996788,
          0.23223814, 0.00055605615, 0.93400246, 0.03902574, 0.3319783,
          0.062036555, 0.668392, 0.00038860738, 0.19207878, 0.070147336,
          0.027078338, 0.0021517584, 0.06600088, 0.0020279675, 0.0011631658,
          0.901095, 0.14573155, 0.683929, 0.0012398277, 0.091163486,
          0.00011119224, 0.20935522, 0.8356558, 0.88468075, 0.0001961957,
          0.70741576, 0.02812494, 0.0004179734, 0.218337, 0.0002477957,
          0.6529579, 0.04791591, 0.005773022, 0.5923544, 0.32623887,
          0.063996196, 0.0007329194, 0.032630667, 0.0016926778, 0.7790164,
          0.21381749, 0.4640079, 0.088631764, 0.0680511, 0.0001544336,
          0.00031118118, 0.18790293, 0.0015921236, 0.019762803, 0.12881498,
          0.0000665322, 0.5054103, 0.4505447, 0.15655215, 0.001798676,
          0.7231869, 0.7951262, 0.058250114, 0.8438003, 0.26665914,
          0.000032203934, 0.645281, 0.025076767, 0.7152904, 0.29292294,
          0.006711854, 0.20060238, 0.10458887, 0.08371839, 0.3984931, 1,
          0.033839896, 0.0002122124, 0.016749244, 0.5482356, 0.0022819922,
          0.0032143213, 0.27699876, 0.10180031, 0.011829419, 0.07229007,
          0.78706336, 0.037675753, 0.14928208, 0.0027140866, 0.5849172,
          0.41122767, 0.2565429, 0.1640482, 0.8764857, 0.054637443,
          0.00026750975, 0.2983406, 0.049534697, 0.5195335, 0.96698344,
          0.5555025, 0.12243452,
        ],
      },
    ],
    series: [
      {
        name: 'survival',
        type: 'line',
        lineStyle: {
          type: 'solid',
        },
        yAxisIndex: 0,
        sampling: 'lttb',
        progressiveThreshold: 5000,
        progressiveChunkMode: 'mod',
        data: [
          0.20495012, 0.13541521, 0.31491888, 0.1837843, 0.0046944944,
          0.009405254, 0.4306811, 0.17972293, 0.9834896, 0.023193464,
          0.12559737, 0.3377702, 0.35545743, 0.052894924, 0.9093128, 0.8032042,
          0.48452348, 0.00445315, 0.81940347, 0.00044928942, 0.00033530974,
          0.113270976, 0.00095740467, 0.0019103561, 0.0010906686, 0.09906384,
          0.77098596, 0.016056756, 0.6995635, 0.00005574342, 0.014740944,
          0.0006846094, 0.4176658, 0.60732496, 0.7549773, 0.002562876,
          0.0063857147, 0.95048624, 0.0006391207, 0.24179025, 0.0033976268,
          0.892884, 0.42415038, 0.5410046, 0.015387503, 0.05119416,
          0.0060729114, 0.0861502, 0.000042513493, 0.16788144, 0.3797523,
          0.14223698, 0.0014064283, 0.0074058706, 0.38595054, 0.000038784023,
          0.107429974, 0.00012083279, 0.010804862, 0.37360358, 0.07671707,
          0.004946765, 0.56280464, 0.01897175, 0.74700034, 0.7311045,
          0.004001774, 0.030312747, 0.0070517617, 0.005485636, 0.22754742,
          0.53381026, 0.00018127044, 0.25156888, 0.95873344, 0.0042223623,
          0.00897332, 0.13879828, 0.59982395, 0.0037910189, 0.8275233,
          0.00022938804, 0.00010225023, 0.056422327, 0.03145515, 0.012370658,
          0.26157296, 0.026062487, 0.008557883, 0.11032392, 0.4438788,
          0.66066176, 0.45725456, 0.526653, 0.096379176, 0.01351368,
          0.00059631455, 0.043297987, 0.2466513, 0.92576724, 0.8682995,
          0.00016737026, 0.3921976, 0.27180114, 0.34361437, 0.014116502,
          0.003039505, 0.7629727, 0.630011, 0.00014240216, 0.30933884,
          0.15288894, 0.000019957717, 0.046337232, 0.008158478, 0.36145565,
          0.16027185, 0.035083394, 0.012931906, 0.67614794, 0.000060921757,
          0.6224191, 0.36750445, 0.17177157, 0.2875598, 0.000035354704,
          0.5701416, 0.021423692, 0.47080424, 0.0028728633, 0.010320533,
          0.000050967705, 0.002418941, 0.63763183, 0.000072606956, 0.6148569,
          0.0035897489, 0.43725744, 0.007774628, 0.40483662, 0.91753715,
          0.22291367, 0.000024224842, 0.011307648, 0.017465534, 0.4776429,
          0.73904246, 0.0052103526, 0.0005182143, 0.00048266485, 0.08133593,
          0.0002886102, 0.49840772, 0.00008628491, 0.000029311084, 0.04479813,
          0.34951022, 0.9422423, 0.4914452, 0.00004656649, 0.093745865,
          0.009854155, 0.00083860103, 0.040412378, 0.17571868, 0.28225172,
          0.07900226, 0.03636184, 0.0007842011, 0.5775126, 0.5124525,
          0.86012274, 0.00009396208, 0.024120629, 0.30381265, 0.0014967811,
          0.000079179335, 0.029202892, 0.000026657342, 0.001320848, 0.11932598,
          0.022294665, 0.00013121904, 0.11627158, 0.0003610858, 0.0010221397,
          0.9917445, 0.23698576, 0.19631195, 0.8519561, 0.8112968, 0.69173443,
          0.32055223, 0.13208748, 0.060121343, 0.018206168, 0.9752357,
          0.020579914, 0.07447983, 0.0008962813, 0.041836258, 0.000021996788,
          0.23223814, 0.00055605615, 0.93400246, 0.03902574, 0.3319783,
          0.062036555, 0.668392, 0.00038860738, 0.19207878, 0.070147336,
          0.027078338, 0.0021517584, 0.06600088, 0.0020279675, 0.0011631658,
          0.901095, 0.14573155, 0.683929, 0.0012398277, 0.091163486,
          0.00011119224, 0.20935522, 0.8356558, 0.88468075, 0.0001961957,
          0.70741576, 0.02812494, 0.0004179734, 0.218337, 0.0002477957,
          0.6529579, 0.04791591, 0.005773022, 0.5923544, 0.32623887,
          0.063996196, 0.0007329194, 0.032630667, 0.0016926778, 0.7790164,
          0.21381749, 0.4640079, 0.088631764, 0.0680511, 0.0001544336,
          0.00031118118, 0.18790293, 0.0015921236, 0.019762803, 0.12881498,
          0.0000665322, 0.5054103, 0.4505447, 0.15655215, 0.001798676,
          0.7231869, 0.7951262, 0.058250114, 0.8438003, 0.26665914,
          0.000032203934, 0.645281, 0.025076767, 0.7152904, 0.29292294,
          0.006711854, 0.20060238, 0.10458887, 0.08371839, 0.3984931, 1,
          0.033839896, 0.0002122124, 0.016749244, 0.5482356, 0.0022819922,
          0.0032143213, 0.27699876, 0.10180031, 0.011829419, 0.07229007,
          0.78706336, 0.037675753, 0.14928208, 0.0027140866, 0.5849172,
          0.41122767, 0.2565429, 0.1640482, 0.8764857, 0.054637443,
          0.00026750975, 0.2983406, 0.049534697, 0.5195335, 0.96698344,
          0.5555025, 0.12243452,
        ],
        showSymbol: false,
        step: false,
        smooth: false,
      },
    ],
    dataZoom: {
      zoomLock: false,
    },
    color: [
      '#6ed0e4',
      '#026e7f',
      '#72b235',
      '#fb7661',
      '#fbb700',
      '#c22a32',
      '#e03c8f',
      '#5d9f27',
      '#9b7fe4',
      '#6344ad',
      '#fee330',
      '#c3c3c3',
    ],
  };

  return <WidgtCard style={styles.cardContainer} option={option} />;
}

function WidgtCard({option}: any) {
  return (
    <Card style={styles.card}>
      <Card.Title title="Bar Chart" />
      <Card.Content style={styles.content}>
        <ChartComponent option={option} />
      </Card.Content>
    </Card>
  );
}

export default WidgetComponent;

const styles = StyleSheet.create({
  cardContainer: {
    width: '100%',
    height: '100%',
    margin: 8,
  },
  card: {
    width: '100%',
    height: '100%',
  },
  content: {
    width: '100%',
    height: '100%',
  },
  chart: {
    width: '100%',
    height: '100%',
  },
});
